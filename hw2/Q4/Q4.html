<!DOCTYPE html>

<!-- To view in browser: python3 -m http.server 8080 & -->
<!-- Then visit http://0.0.0.0:8080/interactive.html in your browser -->
<head>
  <title>Games Rating: 2015 - 2019</title>
  <style>
    /* <!-- define CSS rules --> */
    .point {
  stroke: none;
  fill: #9c9c9c;
  }
  </style>
</head>

<body>
  <script type="text/javascript" src="../lib/d3.v5.min.js"></script>
  <script type="text/javascript" src="../lib/d3-dsv.min.js"></script>

  <!-- Example hiding an element -->
  <!-- <g id="" style"display:none;" /> -->

  <!-- Example of styling an element -->
  <!-- svg_element.style()-->

  <script>
    // define the dimensions and margins for the line chart
    // Use the Margin Convention referenced in the HW document to layout your graph


    // define the dimensions and margins for the bar chart
    // var margin = ({top: 0, right: 0, bottom: 0, left: 0});
    var margin = ({top: 20, right: 30, bottom: 30, left: 40});
    var width = 960 - margin.left - margin.right;
    var height = 500 - margin.top - margin.bottom;

    // append svg element to the body of the page
    // set dimensions and position of the svg element
    // let svg = d3
    //   .select("body")
    //   .append("svg")
    //   .attr("id", "line_chart")
    //   .attr("width", width + margin.left + margin.right)
    //   .attr("height", height + margin.top + margin.bottom)
    //   .append("g")
    //   .attr("id", "container")
      // .attr("transform",
      //   "translate(" + margin.left + "," + margin.top + ")");

    // Fetch the data
	var pathToCsv = "average-rating.csv";


    d3.dsv(",", pathToCsv, function (d) {
      return {
        // format data attributes if required
        name: d.name,
        year: parseInt(d.year),
        avg_rat: Math.floor(parseInt(d.average_rating)),
        usr_rat: parseInt(d.users_rated)
      }
    }).then(function (data) {
      console.log(data); // you should see the data in your browser's developer tools console

      // goal.
      // {year: 2015, '0':12, '1':14,}

      /* Create bar plot using data from csv */
      // Do some javascript to get data in order.
      // var date_filtered_data = data.filter((d) => {return d.year >= 2015 && d.year <= 2019})
      // console.log('***')
      // console.log(date_filtered_data)

      var xyz = [2015,2016,2017,2018,2019].map((year) => {
        return data.filter((x) => {return x.year == year})
      }).map((d) => {
        var x = {
          year: d[0].year,
          0: 0, 
          1: 0,
          2: 0,
          3: 0,
          4: 0,
          5: 0,
          6: 0,
          7: 0,
          8: 0,
          9: 0
        }
        d.forEach((y) => {
          x[y.avg_rat]++
        })
        return x
      })
      console.log('***')
      console.log(xyz)

      var zyx = xyz.map(function(id) {
    // console.log('***')
    // console.log('id', id)
          return {
                id: id.year,
                values: [ {
                        rank: 0,
                        measurement: id[0] },
                         {
                        rank: 1,
                        measurement: id[1] },
                         {
                        rank: 2,
                        measurement: id[2] },
                         {
                        rank: 3,
                        measurement: id[3] },
                         {
                        rank: 4,
                        measurement: id[4] },
                         {
                        rank: 5,
                        measurement: id[5] },
                         {
                        rank: 6,
                        measurement: id[6] },
                         {
                        rank: 7,
                        measurement: id[7] },
                         {
                        rank: 8,
                        measurement: id[8] },
                         {
                        rank: 9,
                        measurement: id[9] },
                        ]
                    };
                })
        console.log('*** zyx ***')
        console.log(zyx)

      // var xyz = [2015,2016,2017,2018,2019].map((year) => {
      //   return data.filter((x) => {return x.year == year})
      // }).map((d) => {
      //   return {
      //     year: d[0].year,
      //     '0': d.reduce((total, id) => {return id.avg_rat == 0 ? total+1:total}, 0), 
      //     '1': d.reduce((total, id) => {return id.avg_rat == 1 ? total+1:total}, 0),
      //     '2': d.reduce((total, id) => {return id.avg_rat == 2 ? total+1:total}, 0),
      //     '3': d.reduce((total, id) => {return id.avg_rat == 3 ? total+1:total}, 0),
      //     '4': d.reduce((total, id) => {return id.avg_rat == 4 ? total+1:total}, 0),
      //     '5': d.reduce((total, id) => {return id.avg_rat == 5 ? total+1:total}, 0),
      //     '6': d.reduce((total, id) => {return id.avg_rat == 6 ? total+1:total}, 0),
      //     '7': d.reduce((total, id) => {return id.avg_rat == 7 ? total+1:total}, 0),
      //     '8': d.reduce((total, id) => {return id.avg_rat == 8 ? total+1:total}, 0),
      //     '9': d.reduce((total, id) => {return id.avg_rat == 9 ? total+1:total}, 0)
      //   }
      // })
      // console.log('***')
      // console.log(xyz)    

      //----------------------------SCALES----------------------------//
      var xScale = d3.scaleLinear().range([margin.left, width - margin.right - margin.left]);
      var yScale = d3.scaleLinear().rangeRound([height-margin.top-margin.bottom, 0]);
      xScale.domain([0,9]);
      // #TODO: update after javascript 
      yScale.domain([(0), d3.max(xyz, function(c) {
          return d3.max([c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]]);
              })
          ]);
      // console.log('xScale',xScale)
      // console.log('yScale',yScale)

      //-----------------------------AXES-----------------------------//
      var y_axis = d3.axisLeft()
          .ticks(10)
          .scale(yScale);

      var x_axis = d3.axisBottom()
          .ticks(10)
          .scale(xScale);


      //----------------------------LINES-----------------------------//
      var line = d3.line()
          .x(function(d) { return xScale(d.rank) + margin.left; })
          .y(function(d) { return yScale(d.measurement) + margin.top; });

      var id = 0;
      var ids = function () {
          return +id++;
        }
      // console.log(id) #* fucking hell
      // ids()
      // console.log(id)

      //----------------------------COLORS-----------------------------//
      var colorArray = [d3.schemeCategory10, d3.schemeAccent];
      var colorScheme = d3.scaleOrdinal(colorArray[0]);
    

      //-------------------------2. DRAWING---------------------------//

      var svg = d3.select("body").append("svg")
          .attr("id", "line_chart")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom);
        
      svg.append("g")
        .attr("id", "container")
      
      // This just moves the entire svg.
      svg.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      //-----------------------------AXES-----------------------------//
      svg.select("g")
        .append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + (margin.left - 0) + "," + (height - margin.bottom + 2) + ")")
        .attr("id",'x-axis-lines')
				.call(x_axis);
        // .append("text")
        // .attr("id", "x_axis_label")
        // .attr("text-anchor", "end")
        // .attr("x", width/2)
        // .attr("y", height - margin.top)
        // .text("Rating"); // I don't know how this shit works, this hw is literarily a try everything till it works exercise of frustration.

      svg.append("text")
        .attr("id", "x-axis-label")
        .attr("text-anchor", "end")
        .attr("x", (width + margin.left + margin.right)/2 )
        .attr("y", height - margin.top + 24)
        .attr("x", (width + margin.left + margin.right)/2 )
        .attr("y", height - margin.top + 24)
        .text("Rating");
      
      svg.select("g")
        .append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + (margin.left + 40) + "," + margin.top + ")")
        .attr("id",'y-axis-lines')
				.call(y_axis)
      
      svg.append("text")
        .attr("id", "y-axis-label")
        .attr("text-anchor", "end")
        .attr("x", -height/2+88)
        .attr("dy", ".75em")
        .attr("transform", "rotate(-90)")
        .text("Count");

      //---------------------------Title-----------------------------//
      svg.append("text")
          .attr("x", (width / 2))             
          .attr("y", margin.top)
          .attr("id", "line_chart_title")
          .attr("text-anchor", "middle")  
          .style("font-size", "16px") 
          .style("text-decoration", "underline")  
          .text("Board games by Rating 2015-2019");
      
      //---------------------------Credits-----------------------------//
      svg.append("text")
          .attr("x", (width / 2))             
          .attr("y", margin.top+42/2)
          .attr("id", "credit")
          .attr("text-anchor", "middle")  
          .style("font-size", "16px") 
          .style("text-decoration", "underline")  
          .text("tjordan60");

          //----------------------------LINES-----------------------------//
    
      var lines = svg.select("g")
          .append("g")
          .attr("id",'lines')
          .selectAll("lines")
          .data(zyx)
          .enter()
          // .select("g")
          .append("g")
          // .attr("id",'lines')
          // .attr("class", "stupid_shit_lines")
          .style("fill", "none")
          .style("stroke-width", "1.5px")
          .style("stroke", function(d) { return d.color = colorScheme(ids())});

      lines.append("path")
          // .attr("class", ids)
          .attr("d", function(d) { return line(d.values); 
          
          });

      // lines.append("text")
      //     .attr("class","series_label")
      //     .datum(function(d) {
      //         return {
      //             id: d.id,
      //             value: d.values[d.values.length - 1]}; })
      //     .attr("transform", function(d) {
      //             return "translate(" + (xScale(d.value.rank) + 40)  
      //             + "," + (yScale(d.value.measurement) + 25 )+ ")"; })
      //     .attr("x", 5)
      //     .text((d)  => {return d.id})
      //     .style("stroke-width", "0.5px")
      //     .style("font", "6px times"); 
              

    //---------------------------POINTS-----------------------------//

    // ALL I CAN SAY IS FUCK HAVING TO LEARN JAVASCRIPT WHEN PRETENDING THIS IS ABOUT D3 AND VISUALIZATION.
    var circles = svg.select("g")
                    .append("g")
                    .attr("id","circles")
                    .selectAll("circles") // GOD DAMN! THIS IS SO ANNOYING!

      for (let i = 0; i < zyx.length; i++) { // FUCK YOU!
      circles
        .data(zyx[i].values)
        .enter()
        // .append("g")
        .append("circle")
        // .attr("id","circle")
        .attr("cx", function(d) {console.log('d',d, 'd.count', d.rank); return xScale(d.rank) + margin.left; })      
        .attr("cy", function(d) {console.log('d',d, 'd.measurement', d.measurement);return yScale(d.measurement) + margin.top; })
        .attr("r", 5)

        .style("fill",function(d) { return zyx[i].color; });
      }

      // Testing without the loop
      // points still in 'wrong' spot! Fuck this auto-grading bullshit! with no help.
      // i = 0
      // svg.select("g")
      //   .append("g")
      //   .attr("id","circles")
      //   .selectAll("circles")
      //   .data(zyx[i].values)
      //   .enter()
      //   .append("circle")
      //   // .attr("id","circle")
      //   .attr("cx", function(d) {console.log('d',d, 'd.count', d.rank); return xScale(d.rank) + margin.left; })      
      //   .attr("cy", function(d) {console.log('d',d, 'd.measurement', d.measurement);return yScale(d.measurement) + margin.top; })
      //   .attr("r", 5)
      //   .style("fill",function(d) { return zyx[i].color; });

      //   i = 4
      //   svg.select("g")
      //   .append("g")
      //   .attr("id","circles")
      //   .selectAll("circles")
      //   .data(zyx[i].values)
      //   .enter()
      //   .append("circle")
      //   // .attr("id","circle")
      //   .attr("cx", function(d) {console.log('d',d, 'd.count', d.rank); return xScale(d.rank) + margin.left; })      
      //   .attr("cy", function(d) {console.log('d',d, 'd.measurement', d.measurement);return yScale(d.measurement) + margin.top; })
      //   .attr("r", 5)
      //   .style("fill",function(d) { return zyx[i].color; });
    // circle.selectAll("circle")
    //     .data(zyx[0].values)
    //     .enter()
    //     .append("g")
    //     .attr("id","circle")
    //     .append("circle")
    //     .attr("cx", function(d) {console.log('d',d, 'd.rank', d.rank); return xScale(d.rank) + margin.left; })      
    //     .attr("cy", function(d) {console.log('d',d, 'd.measurement', d.measurement);return yScale(d.measurement) + margin.top; })    
    //     .attr("r", 5)
    //     .style("fill",function(d) { return zyx[0].color; });

    // svg.append("g")
    //     .attr("id","circle")
    //     .selectAll("circle")
    //     .data(zyx)
    //     .enter()
    //     .append("g")
    //     .attr("id","circle")
    //     .append("circle")
    //     // .attr("cx", function(d, i) {console.log('ass', d, 'd.values', d.values[i], 'd.values.rank', d.values[i].rank, 'xScale(d.values.rank)', xScale(d.values[i].rank)); return xScale(d.values[i].rank) + margin.left; })      
    //     .attr("cx", function(d, i) {console.log('i', i); return xScale(d.values[i].rank) + margin.left; })      
    //     // .attr("cy", function(d, i) {console.log('hats', d); return yScale(d.values.measurement) + margin.top; })    
    //     .attr("cy", function(d, i) {return yScale(d.values[i].measurement) + margin.top; })    
    //     .attr("r", 5)
    //     .style("fill",function(d) { return d.color; });

    // lines
    //     .append("g")
        
    //     .data(function(d) {return d.values})
    //     .enter()
        
        // .append("g")
        // .attr("id","circle")
        
    
    
    // works but wrong DOM, fuck this stupid bull shit!
    // lines.selectAll("points")
    //     .append("g")
    //     .attr("id","circle")
    //     .data(function(d) {return d.values})
    //     .enter()
    //     .append("circle")
    //     // .append("g")
    //     // .attr("id","circle")
    //     .attr("cx", function(d) { return xScale(d.count) + margin.left; })      
    //     .attr("cy", function(d) { return yScale(d.measurement) + margin.top; })    
    //     .attr("r", 5)
    //     .style("fill","black");
        // .style("fill", (d) => {console.log(d); return d.color;});
        // .attr("class","point")
        // .style("opacity", 50)
        // .style("fill", );
        

      //---------------------------LEGEND-----------------------------// 
      var legend_keys = [2015,2016,2017,2018,2019]

      var lineLegend = svg.select("g")
          .append("g")
          .attr("id","legend")
          .selectAll(".lineLegend")
          .data(legend_keys)
          .enter()
          .append("g")
          // .attr("id","legend")
          // .attr("class","legend")
          // .append("g")
          // .attr("id","legend")
          .attr("transform", function (d,i) {
                  return "translate(" + (margin.left) + "," + (i*20)+")";
              });

      lineLegend.append("text").text(function (d) {return d;})
          .attr("transform", "translate(790, 42)"); //align texts with boxes

      lineLegend.append("circle")
          .attr("fill", function(d,i) { return zyx[i].color}) //console.log(zyx[i]);
          .attr("transform", "translate(770, 37)")
          .attr("cx", 0)
          .attr('cy', 0)
          .attr('r', 5);

    // Only do on mouse over event.

    // Creating Div
    d3.select("body").append("div")
    .attr("id", "bar_chart_title")
    .text("Top 5 Most Rated Games of {YEAR} with Rating {RATING}")

    var svg_bar = d3.select("body")
                    .append("svg")
                    .attr("id", "bar_chart")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom);
    
    svg_bar.append("g")
      .attr("id", "container_2")

    // This just moves the entire svg.
    svg_bar.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    //----------------------------SCALES----------------------------//
    var xScale_bar = d3.scaleLinear()
                        .range([margin.left, width - margin.right - margin.left])
                        .domain([0,9]);
    
    var yScale_bar = d3.scaleLinear()
                        .rangeRound([height-margin.top-margin.bottom, 0])
                        .domain([0,5]);

      //-----------------------------AXES-----------------------------//
      var y_axis_bar = d3.axisLeft()
          .ticks(5)
          .scale(yScale_bar);

      var x_axis_bar = d3.axisBottom()
          .ticks(10)
          .scale(xScale_bar);


      svg_bar.select("g")
        .append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + (margin.left - 0) + "," + (height - margin.bottom + 2) + ")")
        .attr("id",'x-axis-bars')
				.call(x_axis_bar);

      svg_bar.append("text")
        .attr("id", "bar_x_axis_label")
        .attr("text-anchor", "end")
        .attr("x", (width + margin.left + margin.right)/2 )
        .attr("y", height - margin.top + 24)
        .attr("x", (width + margin.left + margin.right)/2 )
        .attr("y", height - margin.top + 24)
        .text("Games");
      
      svg_bar.select("g")
        .append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + (margin.left + 40) + "," + margin.top + ")")
        .attr("id",'y-axis-bars')
				.call(y_axis_bar)
      
      svg_bar.append("text")
        .attr("id", "bar_x_axis_label")
        .attr("text-anchor", "end")
        .attr("x", -height/2+88)
        .attr("dy", ".75em")
        .attr("transform", "rotate(-90)")
        .text("Number of Users");





    // #* what is this shit! it prevented my error logs :(
    // }).catch(function (error) {
    //   console.log(error);
    
    });


  </script>

</body>